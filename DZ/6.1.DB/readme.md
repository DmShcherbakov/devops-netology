# 6.1. Типы и структура СУБД - Дмитрий Щербаков

## Задача 1

### Архитектор ПО решил проконсультироваться у вас, какой тип БД лучше выбрать для хранения определенных данных.
### Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:
### - Электронные чеки в json виде
### - Склады и автомобильные дороги для логистической компании
### - Генеалогические деревья
### - Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
### - Отношения клиент-покупка для интернет-магазина
### Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

1. *Электронные чеки в json виде*\
С учетом того, что JSON представляет собой, в общем виде, набор пар "ключ: значение", логично использовать для хранения подобных данных СУБД типа "Key-Value".
2. *Склады и автомобильные дороги для логистической компании*\
Мне кажется, что для решения хранения таких данных наиболее подходящими являются графовые СУБД. Здесь склады будут являться узлами, а дороги - ребрами.
3. *Генеалогические деревья*\
Здесь, по моему мнению, лучше подойдут сетевые (паутинные) СУБД. Имея иерархическую структуру, они, вместе с тем, позволяют объекту иметь более одного родителя, что позволяет полноценно отобразить сложные семейные взаимосвязи.
4. *Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации*\
Как и в п.1, наиболее очевидным для меня решением было бы использование СУБД типа "Key-Value", т.к. требуется хранить информацию типа "идентификатор - клиент", что вполне подходит под концепцию ключ-значение.
5. *Отношения клиент-покупка для интернет-магазина*\
С учетом того, что мы пытаемся сопоставить одному конкретному клиенту набор покупок, и при этом в задаче не обозначена необходимость сопоставлять какие-то иные данные, то, с одной стороны, можно выбрать иерархическую СУБД, где в качестве родителя будет выступать клиент, а дочерние записи содержат названия покупок. С другой же стороны, в интернет-магазинах, как правило, есть сложная структура данных со списком товаров, их характеристиками, стоимостью и прочим. Кроме того, есть множество задач по отслеживанию запасов, формированию статистики и т.д. Поэтому, пытаясь несколько предвосхитить возможные задачи в будущем, я бы выбрал реляционную СУБД, на базе которой формировал бы в последствии необходимые выборки данных.

## Задача 2
### Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если (каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):
### - Данные записываются на все узлы с задержкой до часа (асинхронная запись)
### - При сетевых сбоях, система может разделиться на 2 раздельных кластера
### - Система может не прислать корректный ответ или сбросить соединение
### А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

1. *Данные записываются на все узлы с задержкой до часа (асинхронная запись)*\
В общем виде, здесь можно говорить, по крайней мере, об отсутствии консистентности в приоритетах, поэтому максимум, на что данная система может претендовать по CAP-теореме - AP. С точки зрения PACELC, опять же, ввиду изначального отсутствия консистентности напрашивается PA/EL.
2. *При сетевых сбоях, система может разделиться на 2 раздельных кластера*\
В том случае, если система продолжает отвечать (и вносить данные) после разделения, то мы имеем отсутствие консистентности при наличии доступности и устойчивости к разделению, т.е. AP по CAP. С точки зрения PACELC, то в случае разделенного состояния, очевиден вариант PA, в случае же нормальной работы, возможны оба варианта - как EL, так и EC, в зависимости от конкретной реализации.
3. *Система может не прислать корректный ответ или сбросить соединение*\
Задание в данном виде крайне размыто. Можно рассматривать его с разных сторон:
3.1. Система присылает некорректный ответ. Очевидное отсутствие С при наличии А и, вероятно, Р, раз мы считаем, что она все таки отвечает. Тогда имеем AP по CAP, PA/EL по PACELC.
3.2. Система не присылает никакого ответа (считаем при этом, что сервис, к которому обращаются, жив). Тогда мы видим, что отсутствует доступность. Если предположить, что она отсутствует в борьбе за консистентность, то получаем CP по САР. По PACELC - PC/EC.


## Задача 3
### Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?
Принцип BASE противопоставляется принципу ACID. Здесь идет упор на высокую производительность, а в угоду ей в жертву приносятся базовые принципы ACID - атомарность, согласованность, изоляция и стойкость.

## Задача 4
### Вам дали задачу написать системное решение, основой которого бы послужили:
### - фиксация некоторых значений с временем жизни
### - реакция на истечение таймаута
### Вы слышали о key-value хранилище, которое имеет механизм Pub/Sub. Что это за система? Какие минусы выбора данной системы?
Один из вариантов такого хранилища - Redis. Оно позволяет помещать данные в кэш, задавая в качестве одного из параметров время жизни записи (ttl). По истечении указанного времени жизни, данные будут автоматически удалены. Redis позволяет отслеживать время истечения ключа, информация об истечении копируется и сохраняется на диске. Также он поддерживает механизм pub/sub, который позволяет, с одной стороны, подписаться на канал и получать сообщения из него, а с другой — отправлять в этот канал сообщения, которые будут получены всеми подписчиками.
В качестве недостатков следует отметить следующие:
- Redis хранит данные в оперативной памяти, что, с одной стороны, дает высокую производительность, а с другой - несет риск потери данных в случае сбоя;
- Требует больших объемов оперативной памяти в случае больших объемов данных (что существенно накладнее, чем использовать жесткие диски);
- не поддерживает язык запросов SQL;
- работает в однопоточном режиме, не масштабируется;
- нет механизма разграничения доступа.
