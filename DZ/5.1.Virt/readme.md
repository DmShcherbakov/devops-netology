# 5.1. Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения. - Дмитрий Щербаков

## Задача 1
## Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.

В случае полной виртуализации, достигается минимальный "зазор" между виртуализированной ОС и аппаратным обеспечением. Гипервизор является единственным промежуточным звеном, предоставляя гостевым системам эффективно использовать аппаратные ресурсы.

Паравиртуализация может рассматриваться как "надстройка" над хост-системой, которая позволяет предоставить гостевым машинам некоторую эмуляцию аппаратных ресурсов, ассоциированную с драйверами тех или иных устройств в хост-системе.

Виртуализация на основе ОС позволяет организовывать выполнение кода с использованием уже установленного ядра и окружения, но вынесенное в изолированные области памяти (Jail во FreeBSD, OpenVZ в Linux, Docker и пр.).

## Задача 2
## Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.

Организация серверов:
- физические сервера,
- паравиртуализация,
- виртуализация уровня ОС.

Условия использования:
- Высоконагруженная база данных, чувствительная к отказу.
- Различные web-приложения.
- Windows системы для использования бухгалтерским отделом.
- Системы, выполняющие высокопроизводительные расчеты на GPU.
Опишите, почему вы выбрали к каждому целевому использованию такую организацию.

| № |Условия использования | Организация серверов |
|---|---|---|
| 1 | Высоконагруженная база данных, чувствительная к отказу | физические сервера|
| 2 | Различные web-приложения | виртуализация уровня ОС |
| 3 | Windows системы для использования бухгалтерским отделом | паравиртуализация |
| 4 | Системы, выполняющие высокопроизводительные расчеты на GPU | физические сервера |

1. Высоконагруженная база данных, чувствительная к отказу, формирует большой объем операций ввода-вывода, что, с одной стороны, предъявляет повышенные требования к дисковой подсистеме, а с другой, в случае попыток перемещения ее в виртуальную среду, может оказывать негативное влияние на производительность других гостевых систем. Отказоустойчивость в подобных случаях, как мне видится, правильнее организовывать путем репликации баз данных на нескольких физических серверах.
2. Web-приложения, как правило, представляют из себя набор скриптов(программ) для обеспечения отрисовки интерфейса пользователя и взаимодействия с прочими подсистемами (например, формирования запросов к базам данных, расположенных на других хостах). Тратить ресурсы на развертывание отдельной виртуальной машины или, тем более, выделение физических серверов, в большинстве случаев было бы расточительным. Здесь лучше использовать виртуализацию уровня ОС (тот же Docker, например).
3. Для Windows-окружения заманчивым видится использование бесплатного Hyper-V. С учетом того, что речь идет о некотором обособленном бухгалтерском отделе, а не о сопровождении промышленного ресурса бухгалтерского учета, предоставляющего соответствующие услуги для аутсорса, функционала Hyper-V (с учетом его возможного масштабирования) должно хватить для описанной задачи.
4. Как и в первом пункте, если речь идет о высоконагруженных системах, то, оставляя в стороне вопросы отказоустойчивости, наиболее эффективным я считаю использование физических серверов. В данном случае, ресурсы не расходуются на поддержание работы гипервизора, независимо от его типа.

## Задача 3
## Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.
Сценарии:

1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
2. Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.
4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

|№| Сценарии | Система управления виртуализацией      |
|---|---|----------------------------------------|
|1. |100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.| Vsphere (с использованием DRS) + Veeam |
|2. |Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.| KVM                                    |
|3. |Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.| Hyper-V                                |
|4. |Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.| Vagrant                                |

1. Если в организации есть возможность выделить средства на закупку Vsphere и Veeam Backup & Replications, то данная связка сможет решить обозначенные задачи на высоком качественном уровне.
2. KVM - бесплатный продукт с более простой конфигурацией, нежели это требуется для Xen.
3. Для развертывания Windows-инфраструктуры логичнее использовать "бесплатно" (в довесок к Windows Server) продукт Hyper-V от того же производителя.
4. Vagrant не обладает избыточным функционалом, позволяет осуществлять быстрое развертывание гостевых систем из шаблонов.

## Задача 4
## Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

В случае использования гетерогенной среды виртуализации, основными проблемами, на мой взгляд, являются невозможность миграции виртуальных машин без их остановки (и, в ряде случаев, конвертирования) между разными системами виртуализации, а также возможная несовместимость продуктов резервного копирования, используемых для тех или иных систем. Кроме указанных проблем, следует отметить избыточный расход ресурсов на поддержание работы нескольких систем управления, необходимость иметь в штате сотрудников, способных сопровождать разные продукты (это могут оказаться разные сотрудники, при этом возникают проблемы их взаимозаменяемости).
Для минимизации озвученных проблем, в первую очередь, следует выбирать систему резервного копирования, способную работать со всеми имеющимися средами виртуализации (например, Symantec Backup Exec и Veeam Backup & Replications умеют работать как с VSphere и с Hyper-V). Это позволит, в случае сбоев, осуществлять восстановление виртуальных серверов в любую из доступных сред. Для снижения рисков длительного простоя, связанного с недостаточной квалификацией инженеров в отношении требующей вмешательства системы, необходимо производить обучение персонала и адекватно оценивать необходимую численность сотрудников.

Вопрос о том, стал бы я создавать гетерогенную среду, звучит довольно абстрактно, поэтому ответить на него однозначно нельзя. Например, в моей организации было закуплено несколько лицензий на Vsphere, но при этом количество виртуальных серверов, которые намеревались там разместить было довольно велико. При этом в наличии были уже закупленные сервера с ОС Windows Server, на которой можно было бесплатно воспользоваться Hyper-V. В данном случае, вполне оправданным для нас выглядело решение, когда инфраструктура ЛВС (контроллеры AD, серверы DHCP, Exchange и пр.) была развернута на кластере Hyper-V, а прикладные сервера размещались на кластере VSphere.